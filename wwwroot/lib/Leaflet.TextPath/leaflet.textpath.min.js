(function(){var n=L.Polyline.prototype.onAdd,t=L.Polyline.prototype.onRemove,i=L.Polyline.prototype._updatePath,r=L.Polyline.prototype.bringToFront,u={onAdd:function(t){n.call(this,t);this._textRedraw()},onRemove:function(n){n=n||this._map;n&&this._textNode&&n._renderer._container&&n._renderer._container.removeChild(this._textNode);t.call(this,n)},bringToFront:function(){r.call(this);this._textRedraw()},_updatePath:function(){i.call(this);this._textRedraw()},_textRedraw:function(){var n=this._text,t=this._textOptions;n&&this.setText(null).setText(n,t)},setText:function(n,t){var l,h,r,u,a,f,v,y,e,p,w,c,s;if(this._text=n,this._textOptions=t,!L.Browser.svg||typeof this._map=="undefined")return this;if(l={repeat:!1,fillColor:"black",attributes:{},below:!1},t=L.Util.extend(l,t),!n)return this._textNode&&this._textNode.parentNode&&(this._map._renderer._container.removeChild(this._textNode),delete this._textNode),this;if(n=n.replace(/ /g,"Â "),h="pathdef-"+L.Util.stamp(this),r=this._map._renderer._container,this._path.setAttribute("id",h),t.repeat){u=L.SVG.create("text");for(f in t.attributes)u.setAttribute(f,t.attributes[f]);u.appendChild(document.createTextNode(n));r.appendChild(u);a=u.getComputedTextLength();r.removeChild(u);n=new Array(Math.ceil(this._path.getTotalLength()/a)).join(n)}var i=L.SVG.create("text"),o=L.SVG.create("textPath"),b=t.offset||this._path.getAttribute("stroke-width");o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+h);i.setAttribute("dy",b);for(f in t.attributes)i.setAttribute(f,t.attributes[f]);if(o.appendChild(document.createTextNode(n)),i.appendChild(o),this._textNode=i,t.below?r.insertBefore(i,r.firstChild):r.appendChild(i),t.center&&(v=i.getComputedTextLength(),y=this._path.getTotalLength(),i.setAttribute("dx",y/2-v/2)),t.orientation){e=0;switch(t.orientation){case"flip":e=180;break;case"perpendicular":e=90;break;case"fixed":e=this._parts&&this._parts.length>0?-Math.atan2(this._parts[0][1].y-this._parts[0][0].y,this._parts[0][1].x-this._parts[0][0].x)*180/Math.PI:0;break;default:e=t.orientation}p=i.getBBox().x+i.getBBox().width/2;w=i.getBBox().y+i.getBBox().height/2;i.setAttribute("transform","rotate("+e+" "+p+" "+w+")")}if(this.options.clickable){(L.Browser.svg||!L.Browser.vml)&&o.setAttribute("class","leaflet-clickable");L.DomEvent.on(i,"click",this._onMouseClick,this);for(c=["dblclick","mousedown","mouseover","mouseout","mousemove","contextmenu"],s=0;s<c.length;s++)L.DomEvent.on(i,c[s],this._fireMouseEvent,this)}return this}};L.Polyline.include(u);L.LayerGroup.include({setText:function(n,t){for(var i in this._layers)typeof this._layers[i].setText=="function"&&this._layers[i].setText(n,t);return this}})})();